<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RO/ARO Study Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">
    <div id="loginSection" class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md border-t-8 border-blue-900 text-center">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">Login to MCQ Test</h2>
            <div class="space-y-4 text-left">
                <input type="text" placeholder="Apna Naam" class="w-full p-3 border rounded focus:outline-blue-500">
                <div>
                    <label class="text-sm text-gray-500 font-bold">Subject</label>
                    <select id="mainSubject" onchange="updateSubParts()" class="w-full p-3 border rounded bg-gray-50 font-semibold"></select>
                </div>
                <div id="subPartContainer" class="hidden">
                    <label class="text-sm text-gray-500 font-bold">Select Part (Ancient/Medieval/Modern)</label>
                    <select id="subPart" class="w-full p-3 border rounded bg-blue-50 font-semibold border-blue-200"></select>
                </div>
                <button onclick="startExam()" class="w-full bg-[#003366] text-white py-3 rounded font-bold hover:bg-blue-800 transition">Login & Start</button>
            </div>
        </div>
    </div>

    <div id="examSection" class="hidden max-w-3xl mx-auto py-8 px-4">
        <div class="flex justify-between items-center mb-6 sticky top-0 bg-gray-100 py-2 z-10 border-b">
            <h3 id="currentHeader" class="text-xl font-bold text-blue-900"></h3>
            <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-1 rounded text-sm font-bold">Exit Test</button>
        </div>
        <div id="questionsContainer" class="space-y-8 pb-20"></div>
    </div>

    <script>
        // Aapka updated CSV link yahan hai
        const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSEOVpeHlnybWhmMduLnfUW96Xw-H2g0NUnFEUxTn8CK0cF4A7Bl8nre39W4fzH0pzg7tPwXJa6cFf6/pub?output=csv'; 

        let fullData = [];

        Papa.parse(SHEET_URL, {
            download: true, header: true,
            complete: (res) => {
                fullData = res.data.filter(row => row.Question);
                const subjects = [...new Set(fullData.map(r => r.Subject))];
                const mainSelect = document.getElementById('mainSubject');
                mainSelect.innerHTML = '<option value="">-- Choose Subject --</option>';
                subjects.forEach(s => { if(s) mainSelect.innerHTML += `<option value="${s}">${s}</option>`; });
            }
        });

        function updateSubParts() {
            const sub = document.getElementById('mainSubject').value;
            const subPartSelect = document.getElementById('subPart');
            const container = document.getElementById('subPartContainer');
            subPartSelect.innerHTML = '';
            const parts = [...new Set(fullData.filter(r => r.Subject === sub).map(r => r['Sub-Subject']))];
            if(parts.length > 0 && parts[0] !== "") {
                container.classList.remove('hidden');
                parts.forEach(p => { if(p) subPartSelect.innerHTML += `<option value="${p}">${p}</option>`; });
            } else { container.classList.add('hidden'); }
        }

        function startExam() {
            const s = document.getElementById('mainSubject').value;
            const sp = document.getElementById('subPart').value;
            if(!s) return alert("Pehle Subject chunein!");
            const filtered = fullData.filter(r => r.Subject === s && (sp === "" || r['Sub-Subject'] === sp));
            document.getElementById('loginSection').classList.add('hidden');
            document.getElementById('examSection').classList.remove('hidden');
            document.getElementById('currentHeader').innerText = `${s} > ${sp}`;
            const container = document.getElementById('questionsContainer');
            filtered.forEach((q, i) => {
                container.innerHTML += `
                    <div class="bg-white p-6 rounded-lg shadow border-l-4 border-blue-900">
                        <p class="font-bold text-lg mb-4 text-gray-800">Q.${q.ID}: ${q.Question}</p>
                        <div class="grid gap-3">
                            <button onclick="check(this, '${q.Answer}', '1', 'exp-${i}')" class="text-left p-3 border rounded hover:bg-gray-50 border-gray-300">1. ${q['Option A']}</button>
                            <button onclick="check(this, '${q.Answer}', '2', 'exp-${i}')" class="text-left p-3 border rounded hover:bg-gray-50 border-gray-300">2. ${q['Option B']}</button>
                            <button onclick="check(this, '${q.Answer}', '3', 'exp-${i}')" class="text-left p-3 border rounded hover:bg-gray-50 border-gray-300">3. ${q['Option C']}</button>
                            <button onclick="check(this, '${q.Answer}', '4', 'exp-${i}')" class="text-left p-3 border rounded hover:bg-gray-50 border-gray-300">4. ${q['Option D']}</button>
                        </div>
                        <div id="exp-${i}" class="hidden mt-4 p-4 bg-yellow-50 rounded border border-yellow-200 text-sm">
                            <strong class="text-green-700">Sahi Uttar: ${q.Answer}</strong><br>${q.Explanation}
                        </div>
                    </div>`;
            });
        }

        function check(btn, correct, selected, expId) {
            const btns = btn.parentElement.querySelectorAll('button');
            btns.forEach(b => b.disabled = true);
            if(selected === correct) {
                btn.classList.add('bg-green-100', 'border-green-500');
            } else {
                btn.classList.add('bg-red-100', 'border-red-500');
                btns.forEach(b => { if(b.innerText.startsWith(correct + '.')) b.classList.add('bg-green-100', 'border-green-500'); });
            }
            document.getElementById(expId).classList.remove('hidden');
        }
    </script>
</body>
</html>
